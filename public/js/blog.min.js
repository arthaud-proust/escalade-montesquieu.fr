const months=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],days=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"];function countShoes(t){let e={};return Object.values(t).forEach(t=>{e[t[1]]=t[1]in e?e[t[1]]+1:1}),Object.entries(e).filter(t=>"no-need"!=t[0]).map(t=>t.reverse().join(` paire${t[0]>1?"s":""} de `)).join(",<br>")}function getDate(t,e=!0){let a=void 0===t?"":new Date(t.replace(/-/g,"/"));const s=t=>0==t?"":1==t.toString().length?"0"+t:t;return`${days[a.getDay()]} ${a.getDate()} ${months[a.getMonth()]} <small>${a.getFullYear()}<small> ${e?`à ${s(a.getHours())}H${s(a.getMinutes())}`:""}`}function getPost(t){let e=JSON.parse(t.availables)||{},a=JSON.parse(t.unavailables)||[],s=Object.values(e).filter(t=>1===t[0]).length,n=Object.keys(e).length,i=-1==t.maxplaces?99999:t.maxplaces-n,r=null===t.content?"":anchorme({input:t.content,extensions:[{test:/@(\w|_)+/gi,transform:t=>`<a href="http://escalade-montesquieu.test:8000/profil/${t.substr(1).replace(/(_)+/gi," ")}">${t}</a>`},{test:/\[([^\]]*)\]\(([^)]*)\)/gi,transform:t=>`<a href="https://${t.replace(/\[.+\]\(|\)/gi,"").replace("/","escalade-montesquieu.fr/")}">${t.replace(/\[|\]\(.+\)/gi,"")}</a>`}]});return`\n        <div class="PostCard-content">\n            <h3>${t.title}</h3>\n            <div class="particip">\n                <span class="nb-availables">${n} participant${n>2?"s":""}</span>\n                ${user?user.name in e?`<button class="btn unavailable-post" data-post-id="${t.id}">Se retirer</button>\n                `:`<button class="btn join-post ${i<=0?"disabled":""}" data-post-id="${t.id}">Participer</button>`:`<button class="btn login-user" data-post-id="${t.id}">Participer</button>`}\n            </div>\n        </div>\n            <div class="PostCard-more">\n            ${user&&user.level>1?`\n            <div class="PostCard-adminInfo">\n                <span class="availables">Participants: ${Object.keys(e).join(", ")||"aucun"}</span>\n                <span class="unavailables">Indisponibles: ${a.join(", ")||"aucun"}</span>\n                <span>Baudrier${s>1?"s":""} à prendre: ${s}</span>\n                <span>Chaussures à prendre: ${countShoes(e)||"aucune"}</span>\n            </div>\n            <div class="PostCard-adminActions">\n                <a href="/post/${t.id}/edit" class="btn edit-post" title="Éditer"><img src="/assets/svg/edit-2.svg"></a>\n            </div>`:""}\n            <div class="PostCard-info">\n                ${"true"==$("#post-"+t.id).attr("data-show-datetime")?`<h5>${getDate(t.datetime)}</h5>`:""}\n                <a class="location" target="blank" href="https://www.google.fr/maps/search/${t.location}+france">${null===t.location?"":t.location}</a>\n                <span class="maxplaces">${-1==t.maxplaces?"Places illimitées":i+` ${i>1?"places restantes":"place restante"}`}</span>\n                <p class="desc">${r}</p>\n            </div>\n            ${user&&1==user.level?`\n            <div class="PostCard-adminInfo">\n                <span class="availables">Participants: ${Object.keys(e).join(", ")||"aucun"}</span>\n            </div>\n            `:""}\n        </div>\n    `}function rendPost(t){$("#post-"+t.id).html(getPost(t)),$("#post-"+t.id+" .PostCard-content").click(function(t){if("BUTTON"==t.target.nodeName)return;let e="PostCard"==$(this).parent().attr("class");$(".PostCard-content").parent().attr("class","PostCard"),e&&$(this).parent().attr("class","PostCard open")})}function rendPosts(t,e=!1){t.forEach((a,s)=>{try{e&&t[s-1].datetime.split(" ")[0]!==a.datetime.split(" ")[0]&&$(`<h3 class="date-group">${getDate(a.datetime,!1)}</h3>`).insertBefore("#post-"+a.id)}catch(t){e&&$(`<h3 class="date-group">${getDate(a.datetime,!1)}</h3>`).insertBefore("#post-"+a.id)}rendPost(a)})}function participate(t){t.preventDefault();let e=$(this).attr("data-post-id");axios({method:"post",url:`/post/${e}/participate`}).then(t=>{rendPost(t.data,e),$(".join-post").click(participate),$(".unavailable-post").click(unavailable)})}function unavailable(t){t.preventDefault();let e=$(this).attr("data-post-id");axios({method:"delete",url:`/post/${e}/participate`}).then(t=>{rendPost(t.data,e),$(".join-post").click(participate),$(".unavailable-post").click(unavailable)})}$(()=>{try{rendPosts(posts,!0)}catch(t){console.warn("posts is not defined")}try{$(".infoCard p.paraph").html(function(t,e){return console.log("e"),anchorme({input:e,extensions:[{test:/@(\w|_)+/gi,transform:t=>`<a href="https://escalade-montesquieu.fr/profil/${t.substr(1).replace(/(_)+/gi," ")}">${t}</a>`},{test:/\[([^\]]*)\]\(([^)]*)\)/gi,transform:t=>`<a href="https://${t.replace(/\[.+\]\(|\)/gi,"").replace("/","escalade-montesquieu.fr/")}">${t.replace(/\[|\]\(.+\)/gi,"")}</a>`}]})})}catch(t){console.log(t)}$(".join-post:not(.disabled)").click(participate),$(".unavailable-post").click(unavailable),$(".login-user").click(()=>location.replace("/login"))});
